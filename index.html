<html lang="vi"><head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
<title>Test Trắc Nghiệm Pro</title>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
    </script>
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style>
<style>
    :root {
        --primary-color: #3498db;
        --secondary-color: #2c3e50;
        --accent-color: #e74c3c;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --bg-color: #f4f6f7;
        --text-color: #333;
        --card-bg: #ffffff;
        --input-bg: #ffffff;
        --border-color: #eee;
    }

    /* DARK MODE SUPPORT */
    @media (prefers-color-scheme: dark) {
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --secondary-color: #aab7c4; /* Sáng hơn để dễ đọc trên nền tối */
            --card-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --border-color: #444;
            --primary-color: #5dade2;
        }
        body { color: var(--text-color); }
        .explanation { background: #4a3b00 !important; color: #fff9c4; border-left-color: #ffd700 !important; }
        .rank-table tr:nth-child(even) { background-color: #2a2a2a !important; }
        .rank-table th { background-color: #2c3e50 !important; color: #fff; }
        .q-list-item { background: #2a2a2a !important; border-color: #444 !important; }
        .q-subject-badge { background: #444 !important; color: #ddd !important; }
        .code-block { border-color: #555 !important; }
        .math-block { color: #e0e0e0 !important; }
        
        /* Fix màu cho các input tự động của trình duyệt */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus {
            -webkit-text-fill-color: var(--text-color);
            -webkit-box-shadow: 0 0 0px 1000px #2d2d2d inset;
            transition: background-color 5000s ease-in-out 0s;
        }
    }

    * { box-sizing: border-box; }

    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 15px; min-height: 100vh; transition: background 0.3s, color 0.3s; }
    
    .container { max-width: 950px; margin: 0 auto; background: var(--card-bg); padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: background 0.3s; }
    
    h1 { color: var(--secondary-color); text-align: center; margin-top: 0; font-size: 1.8em; }
    h2, h3 { color: var(--secondary-color); text-align: center; }
    
    .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; color: white; margin: 2px; display: inline-block; }
    .btn-primary { background-color: var(--primary-color); }
    .btn-secondary { background-color: #546e7a; }
    .btn-danger { background-color: var(--accent-color); }
    .btn-success { background-color: var(--success-color); }
    .btn-warning { background-color: var(--warning-color); color: #fff; }
    .btn-purple { background-color: #9b59b6; color: white; }
    .btn-info { background-color: #17a2b8; color: white; }
    .btn-orange { background-color: #fd7e14; color: white; }
    .btn:hover { opacity: 0.9; transform: translateY(-1px); }
    .btn-sm { padding: 5px 10px; font-size: 0.85em; }

    .btn-big-home {
        background-color: #e67e22; color: white; padding: 15px 30px; font-size: 1.1em;
        text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4);
        margin-top: 20px; width: 100%; max-width: 300px;
    }
    .btn-big-home:hover { background-color: #d35400; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(230, 126, 34, 0.6); }

    .screen { display: none; animation: fadeIn 0.5s; }
    .screen.active { display: block; }

    .sticky-header { 
        position: sticky; top: 0; 
        background: var(--card-bg); /* Sửa thành màu card để trùng màu nền dark mode */
        border-bottom: 2px solid var(--primary-color);
        color: var(--text-color); 
        padding: 15px; 
        border-radius: 0 0 8px 8px; 
        margin: -30px -30px 20px -30px; 
        display: flex; justify-content: space-between; align-items: center; 
        z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 1em;
    }
    .header-left { width: 30%; flex: none; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; font-weight: bold; }
    .header-center { flex: 1; text-align: center; font-weight: bold; color: var(--primary-color); text-transform: uppercase; font-size: 0.9em; }
    .header-right { width: 30%; flex: none; text-align: right; font-family: monospace; font-size: 1.3em; font-weight: bold; color: var(--accent-color); }

    .timer-warning { color: red; animation: pulse 1s infinite; }

    .question-card { background: var(--card-bg); margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
    .question-title { font-weight: 700; font-size: 1.15em; margin-bottom: 15px; color: var(--primary-color); }
    
    .code-block { background-color: #282c34; color: #abb2bf; padding: 15px; border-radius: 6px; font-family: 'Consolas', 'Monaco', monospace; margin: 10px 0; border: 1px solid #444; position: relative; overflow-x: auto; font-size: 0.9em; }
    .code-lang-badge { position: absolute; top: 0; right: 0; background: #4b5363; color: #fff; font-size: 0.7em; padding: 2px 8px; border-bottom-left-radius: 4px; font-weight: bold; }
    
    .math-block { margin: 10px 0; padding: 5px; overflow-x: auto; font-size: 1.1em; color: var(--secondary-color); }
    .quiz-image { max-width: 100%; height: auto; display: block; margin: 15px auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border: 1px solid var(--border-color); }

    /* --- NÂNG CẤP PHẦN CHỌN ĐÁP ÁN --- */
    .option-label { 
        display: flex; align-items: flex-start; padding: 12px 15px; 
        border: 2px solid var(--border-color); border-radius: 8px; 
        cursor: pointer; margin-bottom: 10px; transition: all 0.2s ease;
        background-color: var(--input-bg);
        position: relative;
    }
    .option-label input { margin-top: 5px; margin-right: 12px; transform: scale(1.2); flex-shrink: 0; cursor: pointer; }
    .option-label:hover { border-color: var(--primary-color); background-color: rgba(52, 152, 219, 0.05); }
    
    /* Hiệu ứng khi đã chọn */
    .option-label.checked { 
        border-color: var(--primary-color); 
        background-color: rgba(52, 152, 219, 0.15); /* Màu xanh nhạt trong suốt */
        box-shadow: 0 0 0 1px var(--primary-color); /* Viền đôi nổi bật */
        font-weight: 500;
    }
    /* Dark mode override cho hiệu ứng chọn */
    @media (prefers-color-scheme: dark) {
        .option-label.checked { background-color: rgba(52, 152, 219, 0.25); color: #fff; }
        .option-label:hover { background-color: #333; }
    }

    .option-label.correct { background-color: rgba(39, 174, 96, 0.2) !important; border-color: var(--success-color) !important; color: var(--success-color); font-weight: bold; }
    .option-label.incorrect { background-color: rgba(231, 76, 60, 0.2) !important; border-color: var(--accent-color) !important; opacity: 0.7; }
    
    .explanation { background: #fff9c4; padding: 15px; border-radius: 6px; border-left: 5px solid #fbc02d; display: none; margin-top: 15px; font-size: 0.95em; color: #333;}
    
    .result-box { text-align: center; background: var(--card-bg); border: 2px solid var(--secondary-color); padding: 30px; border-radius: 8px; margin-top: 20px; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }

    .manager-section { margin-top: 40px; border-top: 2px dashed var(--border-color); padding-top: 20px; }
    .config-section { background: rgba(52, 152, 219, 0.05); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--primary-color); text-align: center;}
    
    .time-config-row { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px; flex-wrap: wrap; }
    .big-checkbox { transform: scale(1.5); margin-left: 5px; cursor: pointer; }

    .q-list-item { background: var(--bg-color); padding: 10px; margin-bottom: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color); }
    .q-list-content { flex-grow: 1; margin-right: 10px; font-size: 0.9em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-color); }
    .q-subject-badge { font-size: 0.75em; background: #e0e0e0; padding: 2px 6px; border-radius: 4px; margin-right: 5px; color: #333; }
    .q-actions { display: flex; gap: 5px; flex-shrink: 0;}
    .data-controls { margin-bottom: 15px; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 8px; }

    .admin-login-box { text-align: center; padding: 20px; background: var(--bg-color); border-radius: 8px; border: 1px solid var(--border-color); }
    .admin-login-box input { padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; width: 100%; max-width: 250px; margin-bottom: 10px; background: var(--input-bg); color: var(--text-color); }

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
    .modal-overlay.active { display: flex; }
    .modal-content { background: var(--card-bg); width: 95%; max-width: 650px; max-height: 90vh; overflow-y: auto; padding: 25px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); border: 1px solid var(--border-color); }
    
    .form-group { margin-bottom: 15px; }
    .form-label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em; color: var(--text-color); }
    .form-control, .name-input, .subject-select { 
        width: 100%; padding: 12px; border: 2px solid var(--border-color); 
        border-radius: 6px; font-family: inherit; font-size: 1em; 
        background: var(--input-bg); color: var(--text-color); transition: 0.2s;
    }
    .form-control:focus, .name-input:focus, .subject-select:focus { border-color: var(--primary-color); outline: none; }
    textarea.form-control { resize: vertical; min-height: 80px; }
    
    .paste-area { border: 2px dashed var(--border-color); background: rgba(0,0,0,0.02); padding: 20px; text-align: center; border-radius: 6px; cursor: pointer; transition: 0.2s; }
    .paste-area:hover { border-color: var(--primary-color); background: rgba(52, 152, 219, 0.1); }
    .img-preview-box { max-width: 100%; max-height: 200px; margin-top: 10px; display: none; border-radius: 4px; object-fit: contain;}

    .option-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .option-check { transform: scale(1.3); cursor: pointer; flex-shrink: 0; }
    .btn-remove-opt { color: var(--accent-color); background: none; border: none; font-size: 1.5em; cursor: pointer; padding: 0 5px; }

    /* TABLE & RANKING */
    .rank-section { margin-top: 40px; padding-top: 20px; border-top: 4px solid var(--border-color); }
    
    .history-scroll-box {
        max-height: 400px; overflow-y: auto;
        border: 1px solid var(--border-color); border-radius: 8px;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
    }

    .rank-table { width: 100%; border-collapse: collapse; min-width: 500px; }
    .rank-table th, .rank-table td { padding: 12px 10px; border-bottom: 1px solid var(--border-color); text-align: center; font-size: 0.9em; color: var(--text-color); }
    
    .rank-table th { 
        background-color: var(--secondary-color); color: white; 
        position: sticky; top: 0; z-index: 10; font-weight: 600;
    }
    .rank-table tr:nth-child(even) { background-color: rgba(0,0,0,0.03); }
    
    .name-input-group { display: flex; gap: 15px; margin: 20px 0; align-items: flex-end; }
    .input-wrapper { display: flex; flex-direction: column; }
    .box-subject { flex: 1; } 
    .box-name { flex: 1; }

    .name-label { font-weight: bold; font-size: 0.95em; color: var(--primary-color); margin-bottom: 5px; }

    .admin-tabs { display: flex; border-bottom: 2px solid var(--border-color); margin-bottom: 15px; overflow-x: auto; }
    .admin-tab { padding: 10px 15px; cursor: pointer; border: 1px solid transparent; border-bottom: none; border-radius: 6px 6px 0 0; color: var(--text-color); font-weight: 600; white-space: nowrap; opacity: 0.6; }
    .admin-tab.active { background: var(--card-bg); border-color: var(--border-color); border-bottom-color: var(--card-bg); color: var(--primary-color); margin-bottom: -2px; opacity: 1; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

    @media (max-width: 768px) {
        .container { padding: 15px; margin: 0; border-radius: 0; box-shadow: none; max-width: 100%; }
        
        /* Chỉnh lại Header để hiện cả 3 phần trên mobile */
        .sticky-header { 
            margin: -15px -15px 15px -15px; 
            border-radius: 0; 
            padding: 10px; /* Giảm padding */
            gap: 5px;      /* Khoảng cách giữa các phần tử */
        }

        /* 1. Tên thí sinh: Thu nhỏ lại */
        .header-left { 
            width: 25%;         /* Giảm từ 30% xuống 25% */
            font-size: 0.8em;   /* Chữ nhỏ hơn */
        }

        /* 2. Tên môn thi: HIỂN THỊ LẠI */
        .header-center { 
            display: block !important; /* Bắt buộc hiển thị */
            flex: 1;                   /* Tự động chiếm khoảng trống ở giữa */
            font-size: 0.85em;         
            white-space: nowrap;       /* Không xuống dòng */
            overflow: hidden;          /* Ẩn phần chữ thừa */
            text-overflow: ellipsis;   /* Thêm dấu ... nếu tên quá dài */
            text-align: center;
        } 

        /* 3. Đồng hồ: Thu nhỏ lại */
        .header-right {
            width: 15%;        /* Giảm độ rộng để nhường chỗ cho tên môn */
            font-size: 1.1em; 
        }

        /* Các phần khác giữ nguyên */
        .name-input-group { flex-direction: column; gap: 15px; }
        .box-subject, .box-name { width: 100%; flex: none; }
        .btn-group { flex-direction: column; }
        .btn-group .btn { width: 100%; margin: 5px 0; }
        .data-controls { display: flex; flex-direction: column; gap: 10px; }
        .data-controls button { width: 100%; }
        .q-list-item { align-items: flex-start; }
        .time-config-row { gap: 10px; }
    }

/* Mặc định (Light Mode) */
.history-highlight {
    background-color: #e8f8f5;
}

/* Dark Mode: Đổi sang màu tối hơn, hơi trong suốt để dịu mắt */
@media (prefers-color-scheme: dark) {
    .history-highlight {
        background-color: rgba(52, 152, 219, 0.25) !important; 
        color: #fff;
        font-weight: bold;
        border: 1px solid var(--primary-color);
    }
    
    /* Chỉnh lại màu chữ ngày tháng trong dòng highlight cho dễ đọc hơn */
    .history-highlight td:last-child {
        color: #ccc !important;
    }
}
</style>
<style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}
</style></head>
<body>
<div class="container">
    <div id="db-connection-status" style="text-align: center; font-size: 0.85em; margin-bottom: 5px; font-weight: bold; color: #7f8c8d;">
        <span id="status-icon">⚪</span> <span id="status-text">Đang chờ kết nối...</span>
    </div>
    <div class="screen active" id="start-screen">
<h1>Test Trắc Nghiệm Lớp CNTT-VB2</h1>
<div class="name-input-group">
<div class="input-wrapper box-subject">
<span class="name-label">Môn thi:</span>
<select class="subject-select" id="user-subject-select" onchange="Manager.rememberSubject(); QuizApp.updateSubjectInfo()"><option value="ALL">Tất cả môn</option><option value="Chung">Chung</option></select>
</div>
<div class="input-wrapper box-name">
<span class="name-label">Họ và Tên:</span>
<input class="name-input" id="student-name" placeholder="Nhập tên của bạn..." required="" type="text">
</div>
</div>
<div class="config-section">
<p id="subject-info-display" style="font-weight: bold; color: var(--primary-color); margin-bottom: 10px;">Tổng số câu hỏi: 0</p>
<h3>Cấu hình bài thi</h3>
<div class="time-config-row">
<div style="display:flex; align-items:center; gap:5px;">
<label>Giới hạn:</label>
<input disabled="" id="quiz-duration" min="1" style="padding:5px; width:70px; text-align:center;" type="number" value="60"> phút
                </div>
<label style="cursor: pointer; font-weight: bold; color: var(--primary-color); display: flex; align-items: center;">
                    Không giới hạn thời gian
                    <input checked="" class="big-checkbox" id="unlimited-time" onchange="Manager.toggleTimeInput()" type="checkbox">
</label>
</div>
<div class="btn-group" style="display: flex; gap: 10px; justify-content: center;">
<button class="btn btn-secondary" onclick="QuizApp.start(false)">Thứ tự gốc</button>
<button class="btn btn-primary" onclick="QuizApp.start(true)">Trộn câu hỏi &amp; Đảo đáp án</button>
</div>
</div>
<div class="manager-section">
<h3 style="margin-bottom: 15px;">Khu vực Admin</h3>
<div class="admin-login-box" id="admin-login-panel" style="display: block;">
<p>Nhập mật khẩu</p>
<input id="admin-password-input" onkeypress="handleEnterLogin(event)" placeholder="Mật khẩu" type="password">
<br>
<button class="btn btn-secondary" onclick="checkAdminLogin()">Mở khóa</button>
</div>
<div id="admin-content-panel" style="display: none;">
<div class="admin-tabs">
<div class="admin-tab active" onclick="Manager.switchTab('questions')">Ngân hàng câu hỏi</div>
<div class="admin-tab" onclick="Manager.switchTab('subjects')">Quản lý Môn thi</div>
<div class="admin-tab" onclick="Manager.switchTab('settings')">Cài đặt &amp; Bảo mật</div>
</div>
<div id="tab-questions" style="display: block;">
<div class="data-controls">
<button class="btn btn-purple" onclick="DataManager.saveAsHtml()" style="width: 100%; margin-bottom:10px;">💾 Lưu toàn bộ dữ liệu (HTML)</button>
<div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
<button class="btn btn-success btn-sm" onclick="DataManager.exportExcel()">⬇ Xuất Excel</button>
<button class="btn btn-secondary btn-sm" onclick="document.getElementById('file-upload').click()">⬆ Nhập Excel</button>
<button class="btn btn-warning btn-sm" onclick="DataManager.exportCSV_Native()">⬇ Xuất CSV</button>
<button class="btn btn-orange btn-sm" onclick="document.getElementById('file-upload-csv').click()">⬆ Nhập CSV</button>
<input accept=".xlsx, .xls" id="file-upload" onchange="DataManager.importExcel(this)" style="display: none;" type="file">
<input accept=".csv" id="file-upload-csv" onchange="DataManager.importCSV_Native(this)" style="display: none;" type="file">
<button class="btn btn-info btn-sm" onclick="DataManager.reloadFromHTML()">↺ Reload code html</button>
<button class="btn btn-danger btn-sm" onclick="DataManager.resetDefault()">⚠ Delete all data</button>
</div>
<div class="data-controls" style="margin-top: 10px; border-top: 2px dashed #bdc3c7; padding-top: 10px;">
<p style="font-weight:bold; margin-bottom:5px; color: var(--secondary-color);">☁ Cloud / Google Sheet Database & Server Sync</p>
<div style="margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
    
    <div style="display: flex; gap: 5px;">
        <button class="btn btn-secondary btn-sm" onclick="DataManager.exportJSON()">⬇ Xuất JSON</button>
        <button class="btn btn-orange btn-sm" onclick="document.getElementById('json-upload').click()">⬆ Nhập JSON</button>
        <input accept=".json" id="json-upload" onchange="DataManager.importJSONFile(this)" style="display: none;" type="file">
    </div>

    <div style="display: flex; gap: 5px;">
        <button class="btn btn-primary btn-sm" onclick="syncSaveToServer()" title="Lưu toàn bộ dữ liệu hiện tại lên Server">☁ Save Database</button>
        <button class="btn btn-warning btn-sm" onclick="syncLoadFromServer()" title="Tải dữ liệu mới nhất từ Server về máy">☁ Reload Database</button>
    </div>

</div>
<div style="display:flex; gap:5px;">
<input class="form-control" id="cloud-url" placeholder="Dán Link JSON (Apps Script URL)..." style="font-size: 0.9em;" type="text">
<button class="btn btn-primary btn-sm" onclick="DataManager.loadFromCloud()">🔗 Link &amp; Tải về</button>
</div>
<p style="font-size:0.75em; color:#666; margin-top:3px;">
        * Để dùng Google Sheet: Tạo Apps Script với hàm <code>doGet</code> trả về JSON.
    </p>
</div>
<p style="font-size:0.8em; color:#666; text-align:center; margin-top:5px;">
    * <b>CSV</b> chạy được Offline. <b>Excel</b> cần mạng hoặc tải sẵn thư viện.
</p>
</div>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; margin-top: 20px;">
<div>
<select class="form-control" id="admin-filter-subject" onchange="Manager.renderList()" style="width: auto; display: inline-block; padding: 5px;"><option value="ALL">-- Tất cả môn --</option><option value="Chung">Chung</option></select>
<span style="font-size:0.9em;">Tổng: <b id="total-questions-count">0</b></span>
</div>
<button class="btn btn-success btn-sm" onclick="Manager.openModal()">+ Thêm</button>
</div>
<div id="question-list-container" style="max-height: 400px; overflow-y: auto;"></div>
</div>
<div id="tab-subjects" style="display: none;">
<h4>Danh sách môn thi</h4>
<div style="display: flex; gap: 10px; margin-bottom: 15px;">
<input class="form-control" id="new-subject-input" placeholder="Tên môn mới..." type="text">
<button class="btn btn-success" onclick="Manager.addSubject()">Thêm</button>
</div>
<ul id="subject-list-ui" style="list-style: none; padding: 0;"><li style="padding: 8px; border-bottom: 1px solid rgb(238, 238, 238); display: flex; justify-content: space-between;">
                    <span><b>Nguyên Lý Hệ Điều Hành (Chưa xong đáp án)</b> <small>(72 câu)</small></span>
                    <div>
                        <button class="btn btn-primary btn-sm" onclick="Manager.editSubject(0)">✎ Sửa</button>
                        <span style="color:#ccc; font-size:0.8em; margin-left:5px;">(Đang dùng)</span>
                    </div>
                </li><li style="padding: 8px; border-bottom: 1px solid rgb(238, 238, 238); display: flex; justify-content: space-between;">
                    <span><b>Cấu trúc dữ liệu &amp; thuật toán</b> <small>(140 câu)</small></span>
                    <div>
                        <button class="btn btn-primary btn-sm" onclick="Manager.editSubject(1)">✎ Sửa</button>
                        <span style="color:#ccc; font-size:0.8em; margin-left:5px;">(Đang dùng)</span>
                    </div>
                </li><li style="padding: 8px; border-bottom: 1px solid rgb(238, 238, 238); display: flex; justify-content: space-between;">
                    <span><b>(HDH) Chương 3: quản lý bộ nhớ Phân Đoạn</b> <small>(10 câu)</small></span>
                    <div>
                        <button class="btn btn-primary btn-sm" onclick="Manager.editSubject(2)">✎ Sửa</button>
                        <span style="color:#ccc; font-size:0.8em; margin-left:5px;">(Đang dùng)</span>
                    </div>
                </li><li style="padding: 8px; border-bottom: 1px solid rgb(238, 238, 238); display: flex; justify-content: space-between;">
                    <span><b>(HDH) Chương 3: quản lý bộ nhớ Phân Trang</b> <small>(10 câu)</small></span>
                    <div>
                        <button class="btn btn-primary btn-sm" onclick="Manager.editSubject(3)">✎ Sửa</button>
                        <span style="color:#ccc; font-size:0.8em; margin-left:5px;">(Đang dùng)</span>
                    </div>
                </li><li style="padding: 8px; border-bottom: 1px solid rgb(238, 238, 238); display: flex; justify-content: space-between;">
                    <span><b>(HDH) Chương 4</b> <small>(10 câu)</small></span>
                    <div>
                        <button class="btn btn-primary btn-sm" onclick="Manager.editSubject(4)">✎ Sửa</button>
                        <span style="color:#ccc; font-size:0.8em; margin-left:5px;">(Đang dùng)</span>
                    </div>
                </li></ul>
<p style="font-size: 0.8em; color: #666;">* Không thể xóa môn đang có câu hỏi.</p>
</div>
<div id="tab-settings" style="display: none;">
<h4>Đổi mật khẩu Admin</h4>
<p style="font-size:0.9em; color:#555;">Mật khẩu sẽ được mã hóa <b>SHA-256</b>.</p>
<div class="form-group">
<label class="form-label">Mật khẩu cũ:</label>
<input class="form-control" id="old-pass" type="password">
</div>
<div class="form-group">
<label class="form-label">Mật khẩu mới:</label>
<input class="form-control" id="new-pass" type="password">
</div>
<button class="btn btn-primary" onclick="Manager.changePassword()">Lưu mật khẩu</button>
</div>
<div style="text-align: right; margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px;">
<button class="btn btn-secondary btn-sm" onclick="lockAdmin()">🔒 Khóa Admin</button>
</div>
</div>
</div>
<div class="rank-section" id="leaderboard-ui">
<h3>📋 Lịch sử làm bài</h3>
<div class="history-scroll-box">
<table class="rank-table">
<thead>
<tr>
<th width="8%">STT</th>
<th width="18%">Họ Tên</th>
<th width="32%">Môn Thi</th>
<th width="15%">Đúng/Tổng</th>
<th width="12%">Điểm Thi</th>
<th width="15%">Ngày Thi</th>
</tr>
</thead>
<tbody id="rank-body"><tr>
            <td>1</td>
            <td style="font-weight:600">1</td>
            <td>Test</td>
            <td><span style="color:var(--success-color)">0</span>/1</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">2/1/2026 21:19</td>
        </tr><tr>
            <td>2</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>(HDH) Chương 3: quản lý bộ nhớ Phân Đoạn</td>
            <td><span style="color:var(--success-color)">6</span>/10</td>
            <td style="font-weight:bold; color:var(--primary-color)">6</td>
            <td style="font-size:0.85em; color:inherit;">1/1/2026 18:41</td>
        </tr><tr>
            <td>3</td>
            <td style="font-weight:600">T</td>
            <td>Nguyên Lý Hệ Điều Hành</td>
            <td><span style="color:var(--success-color)">0</span>/72</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">1/1/2026 15:29</td>
        </tr><tr>
            <td>4</td>
            <td style="font-weight:600">Thu Nguyen</td>
            <td>Nguyên Lý Hệ Điều Hành</td>
            <td><span style="color:var(--success-color)">1</span>/72</td>
            <td style="font-weight:bold; color:var(--primary-color)">0.1</td>
            <td style="font-size:0.85em; color:inherit;">1/1/2026 0:13</td>
        </tr><tr>
            <td>5</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Cấu trúc dữ liệu &amp; thuật toán</td>
            <td><span style="color:var(--success-color)">1</span>/140</td>
            <td style="font-weight:bold; color:var(--primary-color)">0.1</td>
            <td style="font-size:0.85em; color:inherit;">1/1/2026 0:3</td>
        </tr><tr>
            <td>6</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Tất cả môn</td>
            <td><span style="color:var(--success-color)">0</span>/212</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 23:46</td>
        </tr><tr>
            <td>7</td>
            <td style="font-weight:600">Test</td>
            <td>Cấu trúc dữ liệu &amp; thuật toán</td>
            <td><span style="color:var(--success-color)">1</span>/140</td>
            <td style="font-weight:bold; color:var(--primary-color)">0.1</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 23:34</td>
        </tr><tr>
            <td>8</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Cấu trúc dữ liệu &amp; thuật toán</td>
            <td><span style="color:var(--success-color)">0</span>/140</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 23:14</td>
        </tr><tr>
            <td>9</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Nguyên Lý Hệ Điều Hành</td>
            <td><span style="color:var(--success-color)">0</span>/72</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 23:13</td>
        </tr><tr>
            <td>10</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Tất cả môn</td>
            <td><span style="color:var(--success-color)">0</span>/212</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 23:13</td>
        </tr><tr>
            <td>11</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Cấu trúc dữ liệu &amp; thuật toán</td>
            <td><span style="color:var(--success-color)">0</span>/140</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 22:13</td>
        </tr><tr>
            <td>12</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Nguyên Lý Hệ Điều Hành</td>
            <td><span style="color:var(--success-color)">0</span>/72</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 22:13</td>
        </tr><tr>
            <td>13</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Tất cả môn</td>
            <td><span style="color:var(--success-color)">0</span>/212</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 22:13</td>
        </tr><tr>
            <td>14</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Nguyên Lý Hệ Điều Hành</td>
            <td><span style="color:var(--success-color)">0</span>/72</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 22:7</td>
        </tr><tr>
            <td>15</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Cấu trúc dữ liệu &amp; thuật toán</td>
            <td><span style="color:var(--success-color)">0</span>/140</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 22:7</td>
        </tr><tr>
            <td>16</td>
            <td style="font-weight:600">Tran Anh</td>
            <td>Tất cả môn</td>
            <td><span style="color:var(--success-color)">0</span>/212</td>
            <td style="font-weight:bold; color:var(--primary-color)">0</td>
            <td style="font-size:0.85em; color:inherit;">31/12/2025 22:6</td>
        </tr></tbody>
</table>
</div>
</div>
</div>
<div class="screen" id="quiz-screen">
<div class="sticky-header">
<div class="header-left">
                👤 <span id="display-student-name"></span>
</div>
<div class="header-center">
<span id="display-subject-name">Cấu trúc dữ liệu &amp; thuật toán</span>
</div>
<div class="header-right" id="timer-display">∞</div>
</div>
<div id="quiz-container" style="margin-top: 20px;"></div>
<button class="btn btn-primary" id="submit-btn" onclick="QuizApp.submit()" style="width: 100%; margin-top: 20px; padding: 15px; display: none;">NỘP BÀI</button>
<div class="result-box" id="result-box" style="display: block;">
<h3 style="color: var(--secondary-color);">KẾT QUẢ</h3>
<p style="font-size: 1.2em;">Số câu đúng: <b id="correct-count" style="color:var(--success-color)">11</b> / <span id="total-count">140</span></p>
<div id="final-score" style="font-size: 4em; font-weight: bold; margin: 10px 0; color: var(--primary-color);">0.8</div>
<button class="btn btn-big-home" onclick="QuizApp.resetToHome()">Quay lại màn hình chính</button>
</div>
</div>
</div>
<div class="modal-overlay" id="editor-modal">
<div class="modal-content">
<h3 id="modal-title">Thêm câu hỏi mới</h3>
<input id="edit-index" type="hidden" value="-1">
<div class="form-group">
<label class="form-label">Môn thi:</label>
<select class="form-control" id="inp-subject"><option value="Chung">Chung</option></select>
</div>
<div class="form-group">
<label class="form-label">Nội dung câu hỏi:</label>
<textarea class="form-control" id="inp-question" placeholder="Nhập câu hỏi..." rows="2" style="height: 155px;"></textarea>
</div>
<div class="form-group">
    <label class="form-label">Hình ảnh (Optional):</label>
    <input type="hidden" id="inp-image-data" value="">
    
    <input type="text" class="form-control" id="inp-img-link" placeholder="Dán đường dẫn ảnh (URL) vào đây..." style="margin-bottom: 8px;" onchange="Manager.handleLinkChange(this)">
    
    <div class="paste-area" id="paste-area">
        <p style="margin: 0; color: #777;">Paste (Ctrl+V) hoặc Click chọn file ảnh</p>
        <input type="file" id="inp-file-hidden" accept="image/*" style="display:none;" onchange="Manager.handleFileSelect(this)">
        <img id="img-preview" src="" alt="Preview" class="img-preview-box" style="display: none;">
        <br>
        <button type="button" class="btn btn-danger btn-sm" id="btn-clear-img" onclick="Manager.clearImage()" style="display: none; margin-top: 10px;">Xóa ảnh</button>
    </div>
</div>
<div class="form-group">
<label class="form-label">Công thức Toán (LaTeX):</label>
<textarea class="form-control" id="inp-math" placeholder="Ví dụ: $ x = \frac{-b \pm \sqrt{\Delta}}{2a} $" style="background: #fdfefe;"></textarea>
</div>
<div class="form-group">
<label class="form-label">Code (Optional):</label>
<div style="display: flex; gap: 5px; margin-bottom: 5px;">
<select class="form-control" id="inp-code-lang" style="width: auto;">
<option value="plaintext">Text</option>
<option value="cpp">C/C++</option>
<option value="csharp">C#</option>
<option value="python">Python</option>
<option value="javascript">JS</option>
</select>
</div>
<textarea class="form-control" id="inp-code" placeholder="Dán code vào đây..." rows="4" style="font-family: monospace; background: #282c34; color: #fff;"></textarea>
</div>
<div class="form-group">
<label class="form-label">Loại câu hỏi:</label>
<select class="form-control" id="inp-type" onchange="Manager.changeType()">
<option value="single">Chọn 1 đáp án đúng</option>
<option value="multi">Chọn nhiều đáp án</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Các đáp án (Check vào đáp án đúng):</label>
<div id="options-container"><div class="option-row">
<input class="option-check" name="correct_ans_selector" type="radio">
<input class="form-control option-text" placeholder="Nhập đáp án..." type="text" value="">
<button class="btn-remove-opt" onclick="this.parentElement.remove()" type="button">×</button>
</div><div class="option-row">
<input class="option-check" name="correct_ans_selector" type="radio">
<input class="form-control option-text" placeholder="Nhập đáp án..." type="text" value="">
<button class="btn-remove-opt" onclick="this.parentElement.remove()" type="button">×</button>
</div><div class="option-row">
<input class="option-check" name="correct_ans_selector" type="radio">
<input class="form-control option-text" placeholder="Nhập đáp án..." type="text" value="">
<button class="btn-remove-opt" onclick="this.parentElement.remove()" type="button">×</button>
</div><div class="option-row">
<input class="option-check" name="correct_ans_selector" type="radio">
<input class="form-control option-text" placeholder="Nhập đáp án..." type="text" value="">
<button class="btn-remove-opt" onclick="this.parentElement.remove()" type="button">×</button>
</div></div>
<button class="btn btn-secondary btn-sm" onclick="Manager.addOptionUI()" style="margin-top: 5px;" type="button">+ Thêm dòng</button>
</div>
<div class="form-group">
    <label class="form-label">Giải thích chi tiết:</label>
    <textarea class="form-control" id="inp-note" placeholder="Giải thích chi tiết vì sao đúng..." rows="3" style="min-height: 80px; resize: vertical; font-family: inherit; margin-bottom: 10px;"></textarea>
    
    <label class="form-label" style="font-size: 0.85em; color: #666;">Hình ảnh minh họa giải thích (Optional):</label>
    <input type="hidden" id="inp-note-image-data" value="">
    
    <input type="text" class="form-control" id="inp-note-img-link" placeholder="Dán đường dẫn ảnh giải thích (URL)..." style="margin-bottom: 8px; font-size: 0.9em;" onchange="Manager.handleNoteLinkChange(this)">
    
    <div class="paste-area" id="note-paste-area" style="padding: 10px;">
        <p style="margin: 0; color: #777; font-size: 0.85em;">Paste (Ctrl+V) hoặc Click chọn ảnh giải thích</p>
        <input type="file" id="inp-note-file-hidden" accept="image/*" style="display:none;" onchange="Manager.handleNoteFileSelect(this)">
        <img id="note-img-preview" src="" alt="Preview Note" class="img-preview-box" style="display: none; max-height: 150px;">
        <br>
        <button type="button" class="btn btn-danger btn-sm" id="btn-clear-note-img" onclick="Manager.clearNoteImage()" style="display: none; margin-top: 5px;">Xóa ảnh</button>
    </div>
</div>
<div style="text-align: right; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
<button class="btn btn-secondary" onclick="Manager.closeModal()">Hủy (Esc)</button>
<button class="btn btn-primary" onclick="Manager.saveQuestion()">Lưu</button>
</div>
</div>
</div>
<script>
    // ==========================================
    // CẤU HÌNH DATABASE (FIREBASE)
    // ==========================================
    // Thay URL Firebase của bạn vào đây (Phải kết thúc bằng .json)
    const SYNC_API_URL = 'https://tracnghiemonline-ad6a3-default-rtdb.firebaseio.com/.json'; 

    // Biến lưu trữ dữ liệu toàn cục trong RAM
    let GLOBAL_DATA = {
        questions: [],
        leaderboard: [],
        config: { subjects: ["Chung"], adminHash: "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3" }
    };

    let QUESTION_DB = GLOBAL_DATA.questions;

    // ==========================================
    // HELPER: UI STATUS & UTILS
    // ==========================================
    function updateStatusUI(type, message) {
        const iconSpan = document.getElementById('status-icon');
        const textSpan = document.getElementById('status-text');
        if (!textSpan) return;
        textSpan.innerText = message;
        if (type === 'loading') { iconSpan.innerText = '⏳'; textSpan.style.color = '#e67e22'; }
        else if (type === 'success') { iconSpan.innerText = '✅'; textSpan.style.color = '#27ae60'; }
        else if (type === 'error') { iconSpan.innerText = '❌'; textSpan.style.color = '#c0392b'; }
        else { iconSpan.innerText = '⚪'; textSpan.style.color = '#7f8c8d'; }
    }

    const Utils = {
        sha256: function(ascii) {
            function rightRotate(value, amount) { return (value>>>amount) | (value<<(32 - amount)); }
            var mathPow = Math.pow; var maxWord = mathPow(2, 32); var lengthProperty = 'length'; var i, j;
            var result = ''; var words = []; var asciiBitLength = ascii[lengthProperty]*8;
            var hash = [0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19];
            var k = [0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,
                     0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,
                     0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
                     0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,
                     0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,
                     0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
                     0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,
                     0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2];
            ascii += '\x80'; while (ascii[lengthProperty]%64 - 56) ascii += '\x00'; 
            for (i = 0; i < ascii[lengthProperty]; i++) { j = ascii.charCodeAt(i); if (j>>8) return; words[i>>2] |= j << ((3 - i)%4)*8; }
            words[words[lengthProperty]] = ((asciiBitLength/maxWord)|0); words[words[lengthProperty]] = (asciiBitLength)
            for (j = 0; j < words[lengthProperty];) {
                var w = words.slice(j, j += 16); var oldHash = hash; hash = hash.slice(0, 8);
                for (i = 0; i < 64; i++) {
                    var i2 = i + j; var w15 = w[i - 15], w2 = w[i - 2]; var a = hash[0], e = hash[4];
                    var temp1 = hash[7] + (rightRotate(e, 6) ^ rightRotate(e, 11) ^ rightRotate(e, 25)) + ((e&hash[5])^((~e)&hash[6])) + k[i] + (w[i] = (i < 16) ? w[i] : (w[i - 16] + (rightRotate(w15, 7) ^ rightRotate(w15, 18) ^ (w15>>>3)) + w[i - 7] + (rightRotate(w2, 17) ^ rightRotate(w2, 19) ^ (w2>>>10)))|0);
                    var temp2 = (rightRotate(a, 2) ^ rightRotate(a, 13) ^ rightRotate(a, 22)) + ((a&hash[1])^(a&hash[2])^(hash[1]&hash[2]));
                    hash = [(temp1 + temp2)|0].concat(hash); hash[4] = (hash[4] + temp1)|0;
                }
                for (i = 0; i < 8; i++) hash[i] = (hash[i] + oldHash[i])|0;
            }
            for (i = 0; i < 8; i++) { for (j = 3; j + 1; j--) { var b = (hash[i]>>(j*8))&255; result += ((b < 16) ? 0 : '') + b.toString(16); } }
            return result;
        },
        escapeHtml: function(text) {
            if (!text) return "";
            return String(text).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
        }
    };

    // ==========================================
    // CORE: DATA MANAGER (CLOUD ONLY)
    // ==========================================
    const DataManager = {
        // Chỉ dùng LocalStorage cho cài đặt người dùng, KHÔNG lưu Data
        PREF_KEY: 'quiz_user_prefs', 

        init: async function() {
            // 1. Load User Prefs (Tên, Môn đã chọn) từ LocalStorage
            const prefsStr = localStorage.getItem(this.PREF_KEY);
            if (prefsStr) {
                const prefs = JSON.parse(prefsStr);
                if(prefs.name) document.getElementById('student-name').value = prefs.name;
            }

            // 2. Load Dữ liệu chính từ Cloud (Bắt buộc)
            await this.loadFromCloudDB();
        },

        // Hàm tải dữ liệu từ Firebase
        loadFromCloudDB: async function() {
            updateStatusUI('loading', 'Đang tải dữ liệu từ Cloud...');
            try {
                const response = await fetch(SYNC_API_URL);
                if (!response.ok) throw new Error("Không kết nối được Server");
                const data = await response.json();

                if (data) {
                    GLOBAL_DATA = data;
                    // Fix lỗi nếu data trên cloud bị thiếu trường
                    if(!GLOBAL_DATA.questions) GLOBAL_DATA.questions = [];
                    if(!GLOBAL_DATA.config) GLOBAL_DATA.config = { subjects: ["Chung"] };
                    if(!GLOBAL_DATA.leaderboard) GLOBAL_DATA.leaderboard = [];
                    
                    QUESTION_DB = GLOBAL_DATA.questions;
                    
                    // Render UI
                    this.refreshUI();
                    updateStatusUI('success', 'Dữ liệu đã sẵn sàng!');
                } else {
                    updateStatusUI('warning', 'Cloud chưa có dữ liệu (Mới)');
                }
            } catch (error) {
                console.error(error);
                updateStatusUI('error', 'Lỗi tải data: ' + error.message);
                alert("Không tải được dữ liệu! Vui lòng kiểm tra kết nối mạng.");
            }
        },

        // Hàm lưu dữ liệu lên Firebase (Thay thế cho saveToLocal cũ)
        saveToCloudDB: async function(silent = false) {
            if(!silent) updateStatusUI('loading', 'Đang lưu lên Cloud...');
            
            try {
                GLOBAL_DATA.lastSync = new Date().toLocaleString('vi-VN');
                
                await fetch(SYNC_API_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(GLOBAL_DATA)
                });

                if(!silent) updateStatusUI('success', 'Đã lưu thành công!');
                console.log("Auto-saved to cloud.");
            } catch (error) {
                console.error(error);
                if(!silent) {
                    updateStatusUI('error', 'Lỗi lưu: ' + error.message);
                    alert("⚠️ CẢNH BÁO: Không lưu được dữ liệu lên Cloud!\nLỗi: " + error.message);
                }
            }
        },

        // Hàm wrapper để các module khác gọi (thay vì gọi saveToLocal)
        requestSave: function() {
            // Debounce hoặc gọi trực tiếp. Ở đây gọi trực tiếp cho an toàn dữ liệu.
            this.saveToCloudDB();
            this.refreshUI();
        },

        // Lưu cài đặt người dùng vào LocalStorage (chỉ string nhỏ)
        saveUserPrefs: function() {
            const prefs = {
                name: document.getElementById('student-name').value,
                lastSubject: document.getElementById('user-subject-select').value
            };
            localStorage.setItem(this.PREF_KEY, JSON.stringify(prefs));
        },

        refreshUI: function() {
            Manager.updateSubjectLists();
            Manager.renderList();
            this.renderLeaderboard();
            QuizApp.updateSubjectInfo();
            
            // Khôi phục môn đã chọn từ Prefs
            const prefsStr = localStorage.getItem(this.PREF_KEY);
            if(prefsStr) {
                const prefs = JSON.parse(prefsStr);
                const userSel = document.getElementById('user-subject-select');
                if(prefs.lastSubject && (prefs.lastSubject === 'ALL' || GLOBAL_DATA.config.subjects.includes(prefs.lastSubject))) {
                    userSel.value = prefs.lastSubject;
                }
            }
        },
        
        // --- CÁC HÀM EXPORT/IMPORT KHÁC (GIỮ NGUYÊN LOGIC, CHỈ SỬA SAVE) ---
        
        exportExcel: function() {
             if(typeof XLSX === 'undefined') return alert("Chưa tải xong thư viện Excel. Dùng CSV nhé.");
             if (QUESTION_DB.length === 0) return alert("Không có dữ liệu!");
             const rows = this._generateCustomRows();
             const worksheet = XLSX.utils.json_to_sheet(rows);
             const workbook = XLSX.utils.book_new();
             XLSX.utils.book_append_sheet(workbook, worksheet, "NganHangCauHoi");
             XLSX.writeFile(workbook, "CauHoi_Cloud.xlsx");
        },

        exportCSV_Native: function() {
            if (QUESTION_DB.length === 0) return alert("Không có dữ liệu!");
            let maxOpts = 0; QUESTION_DB.forEach(q => { if(q.options.length > maxOpts) maxOpts = q.options.length; });
            let headers = ["STT", "Môn thi", "Câu hỏi", "Link hình ảnh", "Data Code", "Ngôn ngữ Code", "Đáp án đúng", "Giải thích"];
            for(let i=1; i<=maxOpts; i++) headers.push(`Đáp án ${i}`);
            const data = this._generateCustomRows();
            let csvContent = headers.join(",") + "\n";
            data.forEach(row => {
                let rowArr = [];
                headers.forEach(header => {
                    let val = row[header] || "";
                    val = String(val).replace(/"/g, '""'); 
                    if (val.search(/("|,|\n)/g) >= 0) val = `"${val}"`;
                    rowArr.push(val);
                });
                csvContent += rowArr.join(",") + "\n";
            });
            const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = "CauHoi_Offline.csv"; link.click();
        },

        _generateCustomRows: function() {
            return QUESTION_DB.map((q, index) => {
                let correctText = "";
                if(Array.isArray(q.answer)) {
                    let sortedAns = [...q.answer].sort((a,b)=>a-b);
                    correctText = sortedAns.map(i => (q.options[i] || "")).join("///");
                } else { correctText = q.options[q.answer] || ""; }
                let row = {
                    "STT": index + 1, "Môn thi": q.subject || "Chung", "Câu hỏi": q.question || "",
                    "Link hình ảnh": q.image || "", "Data Code": q.code || "", "Ngôn ngữ Code": q.lang || "plaintext",
                    "Đáp án đúng": correctText, "Giải thích": q.note || ""
                };
                q.options.forEach((opt, i) => { row[`Đáp án ${i + 1}`] = opt; });
                return row;
            });
        },

        importExcel: function(inputElement) {
             const file = inputElement.files[0]; if (!file) return;
             const reader = new FileReader();
             reader.onload = function(e) {
                 const data = new Uint8Array(e.target.result);
                 const workbook = XLSX.read(data, {type: 'array'});
                 const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                 DataManager._processImportData(json);
                 inputElement.value = "";
             };
             reader.readAsArrayBuffer(file);
        },

        importCSV_Native: function(inputElement) {
            const file = inputElement.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const rows = DataManager._parseCSV(e.target.result);
                if(!rows || rows.length < 2) return alert("File lỗi!");
                const headers = rows[0]; const json = [];
                for(let i = 1; i < rows.length; i++) {
                    let rowData = rows[i]; if(rowData.length < 2) continue;
                    let obj = {}; headers.forEach((h, index) => { obj[h.trim()] = rowData[index]; });
                    json.push(obj);
                }
                DataManager._processImportData(json);
                inputElement.value = "";
            };
            reader.readAsText(file);
        },

        _parseCSV: function(text) {
            let arr = []; let quote = false; let row = [], col = "";
            for (let c = 0; c < text.length; c++) {
                let cc = text[c], nc = text[c+1];
                if (cc === '"') { if (quote && nc === '"') { col += '"'; c++; } else { quote = !quote; } } 
                else if (cc === ',' && !quote) { row.push(col); col = ""; } 
                else if ((cc === '\r' || cc === '\n') && !quote) {
                    row.push(col); col = ""; if(row.length > 0) arr.push(row); row = [];
                    if (cc === '\r' && nc === '\n') c++;
                } else { col += cc; }
            }
            if(col.length > 0 || row.length > 0) { row.push(col); arr.push(row); }
            return arr;
        },

        _processImportData: function(json) {
            if (json.length === 0) return alert("File rỗng!");
            if(confirm(`Tìm thấy ${json.length} câu hỏi. \nOK = GHI ĐÈ Database\nCancel = THÊM VÀO Database`)) {
                GLOBAL_DATA.questions = [];
            }
            json.forEach(row => {
                const qText = String(row["Câu hỏi"] || row["Question"] || "").trim(); if(!qText) return;
                const subject = String(row["Môn thi"] || row["Subject"] || "Chung").trim();
                if(!GLOBAL_DATA.config.subjects.includes(subject)) GLOBAL_DATA.config.subjects.push(subject);
                
                let opts = [];
                Object.keys(row).forEach(key => {
                    if(key.startsWith("Đáp án") && !key.includes("đúng") && row[key]) opts.push(String(row[key]));
                });
                
                const correctRaw = String(row["Đáp án đúng"] || "").trim();
                let ansIndex = 0;
                if (correctRaw.includes("///")) {
                    let correctParts = correctRaw.split("///").map(s => s.trim());
                    let indices = [];
                    correctParts.forEach(p => { let idx = opts.findIndex(o => String(o).trim() === p); if(idx !== -1) indices.push(idx); });
                    if(indices.length > 0) ansIndex = indices;
                } else {
                    let idx = opts.findIndex(o => String(o).trim() === correctRaw); if(idx !== -1) ansIndex = idx;
                }

                GLOBAL_DATA.questions.push({
                    question: qText, options: opts, answer: ansIndex, note: row["Giải thích"] || "",
                    subject: subject, image: row["Link hình ảnh"] || null, code: row["Data Code"] || null, lang: row["Ngôn ngữ Code"] || "plaintext"
                });
            });
            QUESTION_DB = GLOBAL_DATA.questions;
            this.requestSave(); // SAVE TO CLOUD
            alert("Đã nhập và lưu lên Cloud!");
        },

        renderLeaderboard: function() {
             const tbody = document.getElementById('rank-body'); tbody.innerHTML = '';
             const displayList = GLOBAL_DATA.leaderboard.slice(0, 50);
             if(displayList.length === 0) tbody.innerHTML = '<tr><td colspan="6">Chưa có dữ liệu</td></tr>';
             displayList.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${index+1}</td><td>${Utils.escapeHtml(row.name)}</td><td>${Utils.escapeHtml(row.subject)}</td><td><span style="color:green">${row.correct}</span>/${row.total}</td><td>${row.score}</td><td>${row.date}</td>`;
                tbody.appendChild(tr);
             });
        },
        
        saveAsHtml: function() { alert("Tính năng này đã tắt khi dùng chế độ Cloud Database."); },
        reloadFromHTML: function() { if(confirm("Tải lại trang?")) location.reload(); },
        resetDefault: function() {
            if(confirm("⚠ NGUY HIỂM: Bạn có chắc chắn muốn xóa TOÀN BỘ dữ liệu trên Cloud không?")) {
                GLOBAL_DATA = { questions: [], leaderboard: [], config: { subjects: ["Chung"], adminHash: GLOBAL_DATA.config.adminHash } };
                this.requestSave();
                alert("Đã xóa trắng Database!");
            }
        },

        exportJSON: function() {
            const dataStr = JSON.stringify(GLOBAL_DATA, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = "backup_cloud.json"; a.click();
        },
        importJSONFile: function(inputElement) {
            const file = inputElement.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if(confirm("Ghi đè (OK) hay Gộp (Cancel)?")) GLOBAL_DATA = data;
                    else {
                        if(data.questions) GLOBAL_DATA.questions = GLOBAL_DATA.questions.concat(data.questions);
                        if(data.leaderboard) GLOBAL_DATA.leaderboard = GLOBAL_DATA.leaderboard.concat(data.leaderboard);
                    }
                    QUESTION_DB = GLOBAL_DATA.questions;
                    DataManager.requestSave();
                    alert("Đã nhập JSON và lưu lên Cloud!");
                } catch (err) { alert("Lỗi JSON: " + err); }
                inputElement.value = '';
            };
            reader.readAsText(file);
        },
        // Hàm này giờ không cần thiết vì ta load trực tiếp
        loadFromCloud: function() { this.loadFromCloudDB(); } 
    };

    // ==========================================
    // ADMIN MANAGER
    // ==========================================
    const Manager = {
        currentTab: 'questions',
        switchTab: function(tabName) {
            this.currentTab = tabName;
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#admin-content-panel > div[id^="tab-"]').forEach(d => d.style.display = 'none');
            document.querySelector(`.admin-tab[onclick="Manager.switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).style.display = 'block';
            if(tabName === 'subjects') this.renderSubjectList();
        },
        renderList: function() {
            const listContainer = document.getElementById('question-list-container');
            const filterSub = document.getElementById('admin-filter-subject').value;
            let filteredDB = QUESTION_DB;
            if(filterSub !== 'ALL') { filteredDB = QUESTION_DB.map((q, idx) => ({...q, originalIdx: idx})).filter(q => q.subject === filterSub); } 
            else { filteredDB = QUESTION_DB.map((q, idx) => ({...q, originalIdx: idx})); }
            document.getElementById('total-questions-count').innerText = filteredDB.length;
            listContainer.innerHTML = '';
            filteredDB.forEach((q) => {
                const div = document.createElement('div'); div.className = 'q-list-item';
                div.innerHTML = `
                    <div class="q-list-content"><span class="q-subject-badge">${Utils.escapeHtml(q.subject)}</span><strong>#${q.originalIdx + 1}:</strong> ${Utils.escapeHtml(q.question)}</div>
                    <div class="q-actions"><button class="btn btn-primary btn-sm" onclick="Manager.openModal(${q.originalIdx})">✎</button><button class="btn btn-danger btn-sm" onclick="Manager.deleteQuestion(${q.originalIdx})">🗑</button></div>`;
                listContainer.appendChild(div);
            });
        },
        deleteQuestion: function(index) {
            if(confirm('Xóa câu hỏi này và CẬP NHẬT Cloud?')) {
                QUESTION_DB.splice(index, 1);
                DataManager.requestSave(); // SAVE CLOUD
            }
        },
        updateSubjectLists: function() {
            const subs = GLOBAL_DATA.config.subjects || ["Chung"];
            const adminFilter = document.getElementById('admin-filter-subject');
            const currentFilter = adminFilter.value;
            adminFilter.innerHTML = '<option value="ALL">-- Tất cả môn --</option>';
            subs.forEach(s => { adminFilter.innerHTML += `<option value="${s}">${s}</option>`; });
            adminFilter.value = currentFilter;

            const modalSel = document.getElementById('inp-subject');
            modalSel.innerHTML = '';
            subs.forEach(s => { modalSel.innerHTML += `<option value="${s}">${s}</option>`; });

            const userSel = document.getElementById('user-subject-select');
            const currentUserSel = userSel.value;
            let userOpts = '<option value="ALL">Tất cả môn</option>';
            subs.forEach(s => { userOpts += `<option value="${s}">${s}</option>`; });
            userSel.innerHTML = userOpts;
            if(currentUserSel && (currentUserSel === 'ALL' || subs.includes(currentUserSel))) { userSel.value = currentUserSel; } 
            else { userSel.value = "ALL"; }
        },
        renderSubjectList: function() {
            const ul = document.getElementById('subject-list-ui'); ul.innerHTML = '';
            GLOBAL_DATA.config.subjects.forEach((s, idx) => {
                const li = document.createElement('li');
                li.style = "padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;";
                const count = QUESTION_DB.filter(q => q.subject === s).length;
                const deleteBtn = (count === 0 && GLOBAL_DATA.config.subjects.length > 1) ? `<button class="btn btn-danger btn-sm" onclick="Manager.removeSubject(${idx})">Xóa</button>` : `<span style="color:#ccc; font-size:0.8em;">(Đang dùng)</span>`;
                li.innerHTML = `<span><b>${s}</b> <small>(${count} câu)</small></span><div><button class="btn btn-primary btn-sm" onclick="Manager.editSubject(${idx})">✎ Sửa</button>${deleteBtn}</div>`;
                ul.appendChild(li);
            });
        },
        addSubject: function() {
            const inp = document.getElementById('new-subject-input');
            const val = inp.value.trim();
            if(!val || GLOBAL_DATA.config.subjects.includes(val)) return;
            GLOBAL_DATA.config.subjects.push(val);
            DataManager.requestSave(); // SAVE CLOUD
            inp.value = ''; this.renderSubjectList();
        },
        editSubject: function(idx) {
            const oldName = GLOBAL_DATA.config.subjects[idx];
            const newName = prompt("Tên môn mới:", oldName);
            if(newName && newName.trim() !== "" && newName !== oldName) {
                if(GLOBAL_DATA.config.subjects.includes(newName)) return;
                GLOBAL_DATA.config.subjects[idx] = newName;
                QUESTION_DB.forEach(q => { if(q.subject === oldName) q.subject = newName; });
                DataManager.requestSave(); // SAVE CLOUD
                this.renderSubjectList();
            }
        },
        removeSubject: function(idx) {
            if(confirm("Xóa môn này?")) {
                GLOBAL_DATA.config.subjects.splice(idx, 1);
                DataManager.requestSave(); // SAVE CLOUD
                this.renderSubjectList();
            }
        },
        rememberSubject: function() { DataManager.saveUserPrefs(); },
        changePassword: function() {
            const oldP = document.getElementById('old-pass').value;
            const newP = document.getElementById('new-pass').value;
            if(!oldP || !newP) return;
            const currentHash = GLOBAL_DATA.config.adminHash || Utils.sha256("123");
            if(Utils.sha256(oldP) !== currentHash) return alert("Mật khẩu cũ sai!");
            GLOBAL_DATA.config.adminHash = Utils.sha256(newP);
            DataManager.requestSave(); // SAVE CLOUD
            alert("Đổi thành công!");
        },
        handleLinkChange: function(ele) {
            const url = ele.value.trim();
            if(url) {
                const img = document.getElementById('img-preview'); img.src = url; img.style.display = 'block';
                document.getElementById('btn-clear-img').style.display = 'inline-block';
                document.getElementById('inp-image-data').value = ""; 
                document.getElementById('inp-file-hidden').value = "";
            } else { this.clearImage(); }
        },
        handleNoteLinkChange: function(ele) {
            const url = ele.value.trim();
            if(url) {
                const img = document.getElementById('note-img-preview'); img.src = url; img.style.display = 'block';
                document.getElementById('btn-clear-note-img').style.display = 'inline-block';
                document.getElementById('inp-note-image-data').value = ""; document.getElementById('inp-note-file-hidden').value = "";
            } else { this.clearNoteImage(); }
        },
        initImageHandlers: function() {
            const pasteArea = document.getElementById('paste-area');
            pasteArea.addEventListener('click', () => document.getElementById('inp-file-hidden').click());
            const notePasteArea = document.getElementById('note-paste-area');
            notePasteArea.addEventListener('click', () => document.getElementById('inp-note-file-hidden').click());
            document.addEventListener('paste', (e) => { 
                if (!document.getElementById('editor-modal').classList.contains('active')) return; 
                if (e.clipboardData && e.clipboardData.items) { 
                    for (let i = 0; i < e.clipboardData.items.length; i++) { 
                        if (e.clipboardData.items[i].type.indexOf("image") !== -1) { 
                            const file = e.clipboardData.items[i].getAsFile();
                            const activeId = document.activeElement.id;
                            const isHoveringNote = document.querySelector('#note-paste-area:hover') != null;
                            if (activeId === 'inp-note' || activeId === 'inp-note-img-link' || isHoveringNote) { this.processNoteImageFile(file); } 
                            else { this.processImageFile(file); }
                            break; 
                        } 
                    } 
                } 
            });
        },
        handleFileSelect: function(input) { if (input.files && input.files[0]) this.processImageFile(input.files[0]); },
        handleNoteFileSelect: function(input) { if (input.files && input.files[0]) this.processNoteImageFile(input.files[0]); },
        processImageFile: function(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('inp-image-data').value = e.target.result;
                const img = document.getElementById('img-preview'); img.src = e.target.result; img.style.display = 'block';
                document.getElementById('btn-clear-img').style.display = 'inline-block';
                document.getElementById('inp-img-link').value = "";
            }; reader.readAsDataURL(file);
        },
        processNoteImageFile: function(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('inp-note-image-data').value = e.target.result;
                const img = document.getElementById('note-img-preview'); img.src = e.target.result; img.style.display = 'block';
                document.getElementById('btn-clear-note-img').style.display = 'inline-block';
                document.getElementById('inp-note-img-link').value = "";
            }; reader.readAsDataURL(file);
        },
        clearImage: function(clearInput = true) {
            if(clearInput) document.getElementById('inp-image-data').value = "";
            document.getElementById('img-preview').style.display = "none"; document.getElementById('img-preview').src = "";
            document.getElementById('btn-clear-img').style.display = "none";
            document.getElementById('inp-file-hidden').value = ""; document.getElementById('inp-img-link').value = "";
        },
        clearNoteImage: function(clearInput = true) {
            if(clearInput) document.getElementById('inp-note-image-data').value = "";
            document.getElementById('note-img-preview').style.display = "none"; document.getElementById('note-img-preview').src = "";
            document.getElementById('btn-clear-note-img').style.display = "none";
            document.getElementById('inp-note-file-hidden').value = ""; document.getElementById('inp-note-img-link').value = "";
        },
        openModal: function(index = -1) {
            const modal = document.getElementById('editor-modal');
            const container = document.getElementById('options-container');
            document.getElementById('edit-index').value = index;
            container.innerHTML = ''; 
            this.clearImage(true); this.clearNoteImage(true);

            if (index === -1) { 
                document.getElementById('modal-title').innerText = "Thêm câu hỏi mới";
                document.getElementById('inp-question').value = "";
                document.getElementById('inp-math').value = "";
                document.getElementById('inp-code').value = "";
                document.getElementById('inp-code-lang').value = "plaintext";
                document.getElementById('inp-note').value = "";
                document.getElementById('inp-type').value = "single";
                const filterVal = document.getElementById('admin-filter-subject').value;
                if(filterVal !== 'ALL') document.getElementById('inp-subject').value = filterVal;
                for(let i=0; i<4; i++) this.addOptionUI('', false);
            } else { 
                const q = QUESTION_DB[index];
                document.getElementById('modal-title').innerText = "Sửa câu hỏi #" + (index + 1);
                document.getElementById('inp-subject').value = q.subject || "Chung";
                document.getElementById('inp-question').value = q.question;
                if(q.image) {
                    const img = document.getElementById('img-preview'); img.src = q.image; img.style.display = 'block';
                    document.getElementById('btn-clear-img').style.display = 'inline-block';
                    if (q.image.startsWith("http") || q.image.startsWith("//")) document.getElementById('inp-img-link').value = q.image;
                    else document.getElementById('inp-image-data').value = q.image;
                }
                if(q.noteImage) {
                    const imgNote = document.getElementById('note-img-preview'); imgNote.src = q.noteImage; imgNote.style.display = 'block';
                    document.getElementById('btn-clear-note-img').style.display = 'inline-block';
                    if (q.noteImage.startsWith("http") || q.noteImage.startsWith("//")) document.getElementById('inp-note-img-link').value = q.noteImage;
                    else document.getElementById('inp-note-image-data').value = q.noteImage;
                }
                document.getElementById('inp-math').value = q.math || "";
                document.getElementById('inp-code').value = q.code || "";
                document.getElementById('inp-code-lang').value = q.lang || "plaintext";
                document.getElementById('inp-note').value = q.note || "";
                const isMulti = Array.isArray(q.answer);
                document.getElementById('inp-type').value = isMulti ? 'multi' : 'single';
                q.options.forEach((optText, i) => {
                    let isCorrect = isMulti ? q.answer.includes(i) : q.answer === i;
                    this.addOptionUI(optText, isCorrect);
                });
            }
            modal.classList.add('active');
        },
        closeModal: function() { document.getElementById('editor-modal').classList.remove('active'); },
        addOptionUI: function(text = '', isChecked = false) {
            const container = document.getElementById('options-container');
            const type = document.getElementById('inp-type').value; 
            const inputType = (type === 'single') ? 'radio' : 'checkbox';
            const div = document.createElement('div'); div.className = 'option-row';
            div.innerHTML = `<input type="${inputType}" name="correct_ans_selector" class="option-check" ${isChecked ? 'checked' : ''}><input type="text" class="form-control option-text" value="${Utils.escapeHtml(text)}" placeholder="Nhập đáp án..."><button type="button" class="btn-remove-opt" onclick="this.parentElement.remove()">×</button>`;
            container.appendChild(div);
        },
        changeType: function() {
            const type = document.getElementById('inp-type').value;
            const inputType = (type === 'single') ? 'radio' : 'checkbox';
            document.querySelectorAll('input[name="correct_ans_selector"]').forEach(inp => { inp.type = inputType; inp.checked = false; });
        },
        saveQuestion: function() {
            const qText = document.getElementById('inp-question').value.trim();
            const qImage = document.getElementById('inp-img-link').value.trim() || document.getElementById('inp-image-data').value.trim();
            const nImage = document.getElementById('inp-note-img-link').value.trim() || document.getElementById('inp-note-image-data').value.trim();
            const qMath = document.getElementById('inp-math').value.trim();
            const qCode = document.getElementById('inp-code').value.trim();
            const qLang = document.getElementById('inp-code-lang').value;
            const qNote = document.getElementById('inp-note').value.trim();
            const qSub = document.getElementById('inp-subject').value;
            const qType = document.getElementById('inp-type').value;
            const index = parseInt(document.getElementById('edit-index').value);

            const optRows = document.querySelectorAll('.option-row');
            let optionsArr = []; let correctIndices = [];
            optRows.forEach((row, i) => {
                const text = row.querySelector('.option-text').value.trim();
                const isChecked = row.querySelector('.option-check').checked;
                if (text) { optionsArr.push(text); if (isChecked) correctIndices.push(optionsArr.length - 1); }
            });

            if (!qText) return alert("Vui lòng nhập nội dung!");
            if (optionsArr.length < 2) return alert("Cần ít nhất 2 đáp án!");
            if (correctIndices.length === 0) return alert("Chọn ít nhất 1 đáp án đúng!");
            if (qType === 'single' && correctIndices.length > 1) return alert("Chọn 1 đáp án thì không được tick nhiều!");

            let finalAnswer = (qType === 'single') ? correctIndices[0] : correctIndices;
            const newQuestion = {
                question: qText, image: qImage || null, math: qMath || null, code: qCode || null, lang: qLang || 'plaintext',
                options: optionsArr, answer: finalAnswer, note: qNote, subject: qSub, noteImage: nImage || null
            };

            if (index === -1) QUESTION_DB.push(newQuestion);
            else QUESTION_DB[index] = newQuestion;

            DataManager.requestSave(); // SAVE CLOUD
            this.closeModal();
        },
        toggleTimeInput: function() {
            const isUnlimited = document.getElementById('unlimited-time').checked;
            const timeInput = document.getElementById('quiz-duration');
            timeInput.disabled = isUnlimited;
            if (isUnlimited) timeInput.style.opacity = "0.5";
            else { timeInput.style.opacity = "1"; timeInput.focus(); }
        }
    };

    // ==========================================
    // QUIZ APP
    // ==========================================
    const QuizApp = {
        currentData: [], timerInterval: null, currentPlayerName: '', currentSubject: '',
        updateSubjectInfo: function() {
            const sel = document.getElementById('user-subject-select').value;
            let count = 0; if(sel === 'ALL') count = QUESTION_DB.length; else count = QUESTION_DB.filter(q => q.subject === sel).length;
            document.getElementById('subject-info-display').innerText = `Tổng số câu hỏi: ${count}`;
        },
        start: function(isShuffle) {
            const nameInput = document.getElementById('student-name');
            const subjectSel = document.getElementById('user-subject-select').value;
            const nameVal = nameInput.value.trim();
            if (!nameVal) { alert("Vui lòng nhập tên của bạn!"); nameInput.focus(); return; }

            let dataToUse = [];
            if(subjectSel === 'ALL') dataToUse = [...QUESTION_DB]; else dataToUse = QUESTION_DB.filter(q => q.subject === subjectSel);
            if(dataToUse.length === 0) return alert("Môn này chưa có câu hỏi nào!");

            this.currentPlayerName = nameVal; this.currentSubject = subjectSel;
            DataManager.saveUserPrefs(); // Save name locally

            const isUnlimited = document.getElementById('unlimited-time').checked;
            let durationMin = parseInt(document.getElementById('quiz-duration').value);
            if(isNaN(durationMin) || durationMin < 1) durationMin = 30;

            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('quiz-screen').classList.add('active');
            document.getElementById('result-box').style.display = 'none'; document.getElementById('submit-btn').style.display = 'block';
            document.getElementById('display-student-name').innerText = this.currentPlayerName;
            document.getElementById('display-subject-name').innerText = (subjectSel === 'ALL') ? "TẤT CẢ MÔN" : subjectSel;

            dataToUse = JSON.parse(JSON.stringify(dataToUse));
            if (isShuffle) { dataToUse.sort(() => Math.random() - 0.5); dataToUse = dataToUse.map(q => this.shuffleOptionsInQuestion(q)); }
            this.currentData = dataToUse;
            this.render(); this.startTimer(durationMin, isUnlimited);
            window.scrollTo(0, 0);
        },
        resetToHome: function() {
            if(this.timerInterval) clearInterval(this.timerInterval);
            document.getElementById('quiz-screen').classList.remove('active');
            document.getElementById('start-screen').classList.add('active');
            document.getElementById('timer-display').innerText = "∞";
            DataManager.renderLeaderboard();
        },
        shuffleOptionsInQuestion: function(question) {
            let mappedOptions = question.options.map((opt, i) => ({ text: opt, oldIdx: i }));
            mappedOptions.sort(() => Math.random() - 0.5);
            question.options = mappedOptions.map(m => m.text);
            if (Array.isArray(question.answer)) { question.answer = question.answer.map(ansIdx => mappedOptions.findIndex(m => m.oldIdx === ansIdx)).sort((a,b) => a - b); } 
            else { question.answer = mappedOptions.findIndex(m => m.oldIdx === question.answer); }
            return question;
        },
        render: function() {
            const container = document.getElementById('quiz-container'); let html = '';
            this.currentData.forEach((q, index) => {
                let codeHtml = '';
                if (q.code) { const langClass = q.lang ? `language-${q.lang}` : ''; codeHtml = `<div class="code-block"><span class="code-lang-badge">${q.lang ? q.lang.toUpperCase() : 'CODE'}</span><pre><code class="${langClass}">${Utils.escapeHtml(q.code)}</code></pre></div>`; }
                const mathHtml = q.math ? `<div class="math-block">${Utils.escapeHtml(q.math)}</div>` : '';
                const imgHtml = q.image ? `<img src="${q.image}" class="quiz-image" alt="Hình ảnh câu hỏi">` : '';
                const noteImgHtml = q.noteImage ? `<div style="margin-top:10px; text-align:center;"><img src="${q.noteImage}" class="quiz-image" style="max-height: 250px; border: 1px dashed #ccc; padding: 5px;"></div>` : '';
                const isMulti = Array.isArray(q.answer);
                const inputType = isMulti ? 'checkbox' : 'radio';
                const hint = isMulti ? '<small style="color:var(--primary-color)">(Chọn nhiều)</small>' : '';
                html += `
                <div class="question-card" id="card-${index}" data-type="${isMulti ? 'multi' : 'single'}">
                    <div class="question-title">Câu ${index + 1}: ${Utils.escapeHtml(q.question)} ${hint}</div>
                    ${imgHtml} ${mathHtml} ${codeHtml}
                    <div>
                        ${q.options.map((opt, i) => `
                            <label class="option-label" onclick="QuizApp.selectOption(${index}, this)">
                                <input type="${inputType}" name="q-${index}" value="${i}" style="pointer-events:none;">
                                <span>${Utils.escapeHtml(opt)}</span>
                            </label>`).join('')}
                    </div>
                    <div class="explanation">
                        <strong>Đáp án:</strong> ${isMulti ? q.answer.map(a => q.options[a]).join(', ') : q.options[q.answer]} <br>
                        <em>${q.note || ''}</em>
                        ${noteImgHtml}
                    </div>
                </div>`;
            });
            container.innerHTML = html;
            document.querySelectorAll('pre code').forEach((block) => hljs.highlightElement(block));
            if(window.MathJax) MathJax.typesetPromise();
        },
        selectOption: function(qIdx, label) {
            const card = document.getElementById(`card-${qIdx}`);
            const input = label.querySelector('input');
            const isMulti = card.dataset.type === 'multi';
            if(input.disabled) return; 
            if (isMulti) { input.checked = !input.checked; label.classList.toggle('checked', input.checked); } 
            else { card.querySelectorAll('.option-label').forEach(l => { l.classList.remove('checked'); l.querySelector('input').checked = false; }); label.classList.add('checked'); input.checked = true; }
        },
        startTimer: function(minutes, isUnlimited) {
            const display = document.getElementById('timer-display');
            if(this.timerInterval) clearInterval(this.timerInterval);
            if (isUnlimited) { display.innerText = "∞"; display.classList.remove('timer-warning'); return; }
            let timeLeft = minutes * 60;
            this.updateTimerDisplay(timeLeft, display);
            this.timerInterval = setInterval(() => {
                timeLeft--; this.updateTimerDisplay(timeLeft, display);
                if (timeLeft <= 0) { clearInterval(this.timerInterval); alert("Đã hết thời gian làm bài!"); this.submit(); }
            }, 1000);
        },
        updateTimerDisplay: function(seconds, displayElement) {
            const m = Math.floor(seconds / 60); const s = seconds % 60;
            displayElement.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            if(seconds < 60) displayElement.classList.add('timer-warning'); else displayElement.classList.remove('timer-warning');
        },
        submit: function() {
            if(this.timerInterval) clearInterval(this.timerInterval);
            let score = 0;
            this.currentData.forEach((q, idx) => {
                const card = document.getElementById(`card-${idx}`);
                const inputs = card.querySelectorAll('input');
                const labels = card.querySelectorAll('.option-label');
                const isMulti = Array.isArray(q.answer);
                let userAns = [];
                inputs.forEach((inp, i) => { if(inp.checked) userAns.push(i); inp.disabled = true; });
                let isCorrect = false;
                if(isMulti) {
                    if(userAns.length === q.answer.length && userAns.every(v => q.answer.includes(v))) isCorrect = true;
                    labels.forEach((lbl, i) => {
                        if(q.answer.includes(i)) lbl.classList.add('correct'); 
                        if(userAns.includes(i) && !q.answer.includes(i)) lbl.classList.add('incorrect'); 
                    });
                } else {
                    if(userAns.length > 0 && userAns[0] === q.answer) isCorrect = true;
                    if(q.answer !== undefined && labels[q.answer]) labels[q.answer].classList.add('correct');
                    if(!isCorrect && userAns.length > 0 && labels[userAns[0]]) labels[userAns[0]].classList.add('incorrect');
                }
                if(isCorrect) score++;
                const explainDiv = card.querySelector('.explanation');
                if(explainDiv) explainDiv.style.display = 'block';
            });

            const finalScore = parseFloat((score / this.currentData.length * 10).toFixed(1));
            const date = new Date();
            const dateStr = `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()} ${date.getHours()}:${date.getMinutes()}`;
            
            const newEntry = {
                name: this.currentPlayerName || "Unknown",
                score: finalScore, correct: score, total: this.currentData.length,
                date: dateStr, subject: (this.currentSubject === 'ALL') ? "Tất cả môn" : this.currentSubject
            };

            GLOBAL_DATA.leaderboard.unshift(newEntry);
            if (GLOBAL_DATA.leaderboard.length > 100) GLOBAL_DATA.leaderboard = GLOBAL_DATA.leaderboard.slice(0, 100);

            // SAVE TO CLOUD (Chỉ lưu điểm và history)
            DataManager.requestSave();

            document.getElementById('submit-btn').style.display = 'none';
            const rBox = document.getElementById('result-box'); rBox.style.display = 'block';
            document.getElementById('correct-count').innerText = score;
            document.getElementById('total-count').innerText = this.currentData.length;
            document.getElementById('final-score').innerText = finalScore;
            rBox.scrollIntoView({behavior: 'smooth'});
        }
    };

    // ==========================================
    // AUTHENTICATION
    // ==========================================
    function checkAdminLogin() {
        const inp = document.getElementById('admin-password-input');
        const inputHash = Utils.sha256(inp.value);
        const storedHash = (GLOBAL_DATA.config && GLOBAL_DATA.config.adminHash) ? GLOBAL_DATA.config.adminHash : "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3";
        if (inputHash === storedHash) {
            document.getElementById('admin-login-panel').style.display = 'none';
            document.getElementById('admin-content-panel').style.display = 'block';
            inp.value = ''; Manager.renderList();
        } else { alert("Mật khẩu không đúng!"); inp.value = ''; inp.focus(); }
    }
    function lockAdmin() {
        document.getElementById('admin-login-panel').style.display = 'block';
        document.getElementById('admin-content-panel').style.display = 'none';
    }
    function handleEnterLogin(e) { if(e.key === 'Enter') checkAdminLogin(); }

    // Tự động chạy init
    document.addEventListener("DOMContentLoaded", () => {
        DataManager.init();
        Manager.initImageHandlers();
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") { if (document.getElementById('editor-modal').classList.contains('active')) Manager.closeModal(); }
        });
    });

    // Hàm gọi thủ công từ nút Sync trên UI
    function syncLoadFromServer() { DataManager.loadFromCloudDB(); }
    function syncSaveToServer() { DataManager.saveToCloudDB(); }
</script>
</body></html>